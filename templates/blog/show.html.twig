{% extends 'base.html.twig' %}

{% block title %}{{ post.metaTitle ?? post.title }} | Blog Digitalfy{% endblock %}

{% block meta_description %}{{ post.metaDescription ?? post.excerpt }}{% endblock %}

{% block body %}
<article class="blog-post">
    <header class="post-header">
        <div class="container">
            <nav class="breadcrumb" aria-label="Fil d'Ariane">
                <a href="{{ path('app_home') }}">Accueil</a>
                <span class="breadcrumb-separator">/</span>
                <a href="{{ path('app_blog') }}">Blog</a>
                <span class="breadcrumb-separator">/</span>
                <a href="{{ path('app_blog_category', {slug: post.category.slug}) }}">
                    {{ post.category.name }}
                </a>
                <span class="breadcrumb-separator">/</span>
                <span aria-current="page">{{ post.title }}</span>
            </nav>

            <h1>{{ post.title }}</h1>

            <div class="post-meta">
                <time class="post-date" datetime="{{ post.publishedAt|date('Y-m-d') }}">
                    {{ post.publishedAt|date('d/m/Y') }}
                </time>
                <span class="post-category">
                    <a href="{{ path('app_blog_category', {slug: post.category.slug}) }}">
                        {{ post.category.name }}
                    </a>
                </span>
            </div>

            {% if post.featuredImage %}
                <div class="post-featured-image">
                    <img src="{{ asset('uploads/blog/' ~ post.featuredImage) }}"
                         alt="{{ post.title }}"
                         loading="eager">
                </div>
            {% endif %}
        </div>
    </header>

    <div class="post-content">
        <div class="container">
            {{ post.content|raw }}
        </div>
    </div>

    <footer class="post-footer">
        <div class="container">
            <div class="share-buttons">
                <span class="share-label">Partager cet article :</span>
                <a href="https://twitter.com/intent/tweet?url={{ url('app_blog_show', {slug: post.slug}) }}&text={{ post.title|url_encode }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="share-button share-twitter"
                   aria-label="Partager sur Twitter">
                    <span>Twitter</span>
                </a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ url('app_blog_show', {slug: post.slug}) }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="share-button share-linkedin"
                   aria-label="Partager sur LinkedIn">
                    <span>LinkedIn</span>
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ url('app_blog_show', {slug: post.slug}) }}"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="share-button share-facebook"
                   aria-label="Partager sur Facebook">
                    <span>Facebook</span>
                </a>
            </div>
        </div>
    </footer>

    {% if relatedPosts|length > 0 %}
        <section class="related-posts">
            <div class="container">
                <h2>Articles similaires</h2>
                <div class="blog-grid">
                    {% for relatedPost in relatedPosts %}
                        {% include 'components/_blog-card.html.twig' with {post: relatedPost} %}
                    {% endfor %}
                </div>
            </div>
        </section>
    {% endif %}
</article>

{# Schema.org Article structured data for SEO #}
{% block head_scripts %}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "{{ post.title|escape('js') }}",
    {% if post.featuredImage %}
    "image": "{{ absolute_url(asset('uploads/blog/' ~ post.featuredImage)) }}",
    {% endif %}
    "datePublished": "{{ post.publishedAt|date('c') }}",
    "dateModified": "{{ post.updatedAt|date('c') }}",
    "author": {
        "@type": "Person",
        "name": "Marc Dubois",
        "url": "{{ url('app_home') }}"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Digitalfy",
        "logo": {
            "@type": "ImageObject",
            "url": "{{ absolute_url(asset('images/logo.png')) }}"
        }
    },
    "description": "{{ (post.excerpt ?? post.metaDescription)|escape('js') }}",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ url('app_blog_show', {slug: post.slug}) }}"
    }
}
</script>
{% endblock %}
{% endblock %}
