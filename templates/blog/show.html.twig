{% extends 'base.html.twig' %}

{% block title %}{{ post.title }} | Digitalfy{% endblock %}

{% block meta_description %}{{ post.metaDescription ?? post.excerpt }}{% endblock %}

{# Surcharge des blocs Open Graph pour les articles #}
{% block og_type %}article{% endblock %}
{% block og_title %}{{ post.metaTitle ?? post.title }}{% endblock %}
{% block og_description %}{{ post.metaDescription ?? post.excerpt }}{% endblock %}
{% block og_image %}{% if post.featuredImage %}{{ absolute_url(asset('uploads/blog/' ~ post.featuredImage)) }}{% else %}{{ absolute_url(asset('images/og-default.jpg')) }}{% endif %}{% endblock %}

{# Surcharge des blocs Twitter Cards #}
{% block twitter_title %}{{ post.metaTitle ?? post.title }}{% endblock %}
{% block twitter_description %}{{ post.metaDescription ?? post.excerpt }}{% endblock %}
{% block twitter_image %}{% if post.featuredImage %}{{ absolute_url(asset('uploads/blog/' ~ post.featuredImage)) }}{% else %}{{ absolute_url(asset('images/og-default.jpg')) }}{% endif %}{% endblock %}

{# Meta tags sp√©cifiques aux articles (pas de doublons) #}
{% block meta %}
    {{ parent() }}

    {# Canonical URL sp√©cifique (surcharge celui de base.html.twig) #}
    <link rel="canonical" href="{{ absolute_url(path('app_blog_show', {slug: post.slug})) }}">

    {# Meta tags suppl√©mentaires pour Open Graph articles #}
    {% if post.featuredImage %}
    <meta property="og:image:alt" content="{{ post.imageAlt ?? post.title }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    {% endif %}
    <meta property="article:published_time" content="{{ post.publishedAt|date('c') }}">
    <meta property="article:modified_time" content="{{ post.updatedAt|date('c') }}">
    <meta property="article:author" content="Digitalfy">
    <meta property="article:section" content="{{ post.category.name }}">
    {% if post.focusKeyword %}
    <meta property="article:tag" content="{{ post.focusKeyword }}">
    {% endif %}

    {# Twitter image alt (sp√©cifique) #}
    {% if post.featuredImage %}
    <meta name="twitter:image:alt" content="{{ post.imageAlt ?? post.title }}">
    {% endif %}
{% endblock %}

{% block structured_data %}
    {% include 'partials/schema/article.html.twig' with {'article': post} %}
    {% include 'partials/schema/breadcrumb.html.twig' with {
        'items': [
            {'name': 'Accueil', 'url': path('app_home')},
            {'name': 'Blog', 'url': path('app_blog')},
            {'name': post.category.name, 'url': path('app_blog_category', {slug: post.category.slug})},
            {'name': post.title, 'url': path('app_blog_show', {slug: post.slug})}
        ]
    } %}
{% endblock %}

{% block body %}
<section class="section section--cream">
    <div class="container" style="max-width: 1400px;">
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb__item">
                    <a href="{{ path('app_home') }}" class="breadcrumb__link">Accueil</a>
                </li>
                <li class="breadcrumb__item">
                    <a href="{{ path('app_blog') }}" class="breadcrumb__link">Blog</a>
                </li>
                <li class="breadcrumb__item">
                    <a href="{{ path('app_blog_category', {slug: post.category.slug}) }}" class="breadcrumb__link">{{ post.category.name }}</a>
                </li>
                <li class="breadcrumb__item">
                    <span class="breadcrumb__current">{{ post.title }}</span>
                </li>
            </ol>
        </nav>

        {# Layout 2 colonnes : Article large + Sidebar #}
        <div class="blog-show-layout">
            {# Article principal - Accent mis sur le contenu #}
            <article class="blog-show-article">
                <header class="text-center mb-8">
                    <span class="blog-card__category">{{ post.category.name }}</span>
                    <h1 class="mt-4 mb-4">{{ post.title }}</h1>
                    <div class="text-gray flex flex--center flex--gap-4">
                        <span>üìÖ {{ post.publishedAt|date('d/m/Y') }}</span>
                        {% if post.readingTime %}
                            <span>‚è±Ô∏è {{ post.readingTime }} min de lecture</span>
                        {% endif %}
                    </div>
                </header>

                {% if post.featuredImage %}
                    <img src="{{ asset('uploads/blog/' ~ post.featuredImage) }}"
                         alt="{{ post.imageAlt ?? post.title }}"
                         class="rounded-xl shadow-lg mb-8"
                         loading="lazy"
                         width="900"
                         height="506"
                         style="width: 100%; max-width: 100%; margin-left: auto; margin-right: auto; display: block;">
                {% endif %}

                <div class="card" style="padding: 3rem;">
                    <div class="post-content">
                        {{ post.content|markdown }}
                    </div>
                </div>
            </article>

            {# Sidebar - Plus discr√®te #}
            <aside class="blog-show-sidebar">
                <div style="position: sticky; top: 100px; display: flex; flex-direction: column; gap: 1.5rem;">
                    {% include 'components/_blog-sidebar-categories.html.twig' with {categories: categories} %}
                    {% include 'components/_blog-sidebar-latest.html.twig' with {latestPosts: latestPosts} %}
                </div>
            </aside>
        </div>
    </div>
</section>

<style>
/* Layout pour page d'article - Accent sur le contenu */
.blog-show-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-top: 2rem;
}

/* Mobile : Sidebar en haut */
.blog-show-article {
    order: 2;
}

.blog-show-sidebar {
    order: 1;
}

/* Desktop : Article large √† gauche (75%), Sidebar petite √† droite (25%) */
@media (min-width: 1024px) {
    .blog-show-layout {
        grid-template-columns: 1fr 280px;
        gap: 3rem;
    }

    .blog-show-article {
        order: 1;
    }

    .blog-show-sidebar {
        order: 2;
    }
}

/* Large √©crans : encore plus d'espace pour l'article */
@media (min-width: 1280px) {
    .blog-show-layout {
        grid-template-columns: 1fr 300px;
    }
}
</style>

{# Related Posts #}
{% if relatedPosts|length > 0 %}
<section class="section">
    <div class="container">
        <h2 class="text-center mb-12">Articles similaires</h2>
        <div class="grid grid--3-cols">
            {% for relatedPost in relatedPosts %}
                {% include 'components/_blog-card.html.twig' with {post: relatedPost} %}
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{# CTA Section #}
<section class="section section--gradient">
    <div class="container text-center">
        <h2 class="mb-4">Besoin d'aide pour votre projet digital ?</h2>
        <p class="text-xl mb-8">Contactez-moi pour discuter de vos besoins</p>
        <a href="{{ path('app_contact') }}" class="btn btn--light btn--lg">Prendre contact</a>
    </div>
</section>
{% endblock %}
