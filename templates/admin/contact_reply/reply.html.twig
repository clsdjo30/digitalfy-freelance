{# Template pour la page de réponse à une demande de contact #}
{% extends '@EasyAdmin/page/content.html.twig' %}

{% block page_title %}
    Répondre à la demande de {{ contactRequest.name }}
{% endblock %}

{% block content_title %}
    <h1 class="title">
        <i class="fa fa-reply"></i>
        Répondre à la demande de contact
    </h1>
{% endblock %}

{% block main %}
    <div class="row">
        {# Colonne gauche : Informations de la demande #}
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fa fa-info-circle"></i>
                        Informations de la demande
                    </h5>
                </div>
                <div class="card-body">
                    {# Informations du contact #}
                    <dl class="row">
                        <dt class="col-sm-4">Nom</dt>
                        <dd class="col-sm-8">{{ contactRequest.name }}</dd>

                        <dt class="col-sm-4">Email</dt>
                        <dd class="col-sm-8">
                            <a href="mailto:{{ contactRequest.email }}">
                                {{ contactRequest.email }}
                            </a>
                        </dd>

                        {% if contactRequest.phone %}
                            <dt class="col-sm-4">Téléphone</dt>
                            <dd class="col-sm-8">
                                <a href="tel:{{ contactRequest.phone }}">
                                    {{ contactRequest.phone }}
                                </a>
                            </dd>
                        {% endif %}

                        <dt class="col-sm-4">Type de projet</dt>
                        <dd class="col-sm-8">
                            <span class="badge bg-info">{{ contactRequest.projectType }}</span>
                        </dd>

                        {% if contactRequest.estimatedBudget %}
                            <dt class="col-sm-4">Budget estimé</dt>
                            <dd class="col-sm-8">{{ contactRequest.estimatedBudget }}</dd>
                        {% endif %}

                        <dt class="col-sm-4">Date de soumission</dt>
                        <dd class="col-sm-8">
                            {{ contactRequest.submittedAt|date('d/m/Y à H:i') }}
                        </dd>

                        <dt class="col-sm-4">Statut</dt>
                        <dd class="col-sm-8">
                            {% if contactRequest.status == 'new' %}
                                <span class="badge bg-primary">Nouveau</span>
                            {% elseif contactRequest.status == 'in_progress' %}
                                <span class="badge bg-warning">En cours</span>
                            {% else %}
                                <span class="badge bg-success">Clôturé</span>
                            {% endif %}
                        </dd>
                    </dl>

                    {# Message du client #}
                    <hr>
                    <h6 class="fw-bold">Message du client :</h6>
                    <div class="alert alert-light border">
                        {{ contactRequest.message|nl2br }}
                    </div>

                    {# Notes internes (si existantes) #}
                    {% if contactRequest.notes %}
                        <hr>
                        <h6 class="fw-bold">Notes internes :</h6>
                        <div class="alert alert-warning">
                            {{ contactRequest.notes|nl2br }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        {# Colonne droite : Formulaire de réponse #}
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fa fa-envelope"></i>
                        Votre réponse
                    </h5>
                </div>
                <div class="card-body">
                    {# Affichage des messages flash #}
                    {% for message in app.flashes('success') %}
                        <div class="alert alert-success alert-dismissible fade show">
                            <i class="fa fa-check-circle"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}

                    {% for message in app.flashes('danger') %}
                        <div class="alert alert-danger alert-dismissible fade show">
                            <i class="fa fa-exclamation-triangle"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}

                    {# Informations importantes #}
                    <div class="alert alert-info mb-3">
                        <i class="fa fa-info-circle"></i>
                        <strong>Information :</strong>
                        L'email sera envoyé depuis <strong>contact@digitalfy.fr</strong>
                        vers <strong>{{ contactRequest.email }}</strong>
                    </div>

                    {# Formulaire de réponse #}
                    {{ form_start(form, {
                        'action': path('admin_contact_reply', {'id': contactRequest.id}),
                        'method': 'POST',
                        'attr': {'class': 'contact-reply-form'}
                    }) }}
                        <div class="mb-3">
                            {{ form_label(form.subject, 'Sujet de l\'email', {
                                'label_attr': {'class': 'form-label fw-bold'}
                            }) }}
                            {{ form_widget(form.subject, {
                                'attr': {'class': 'form-control'}
                            }) }}
                            {{ form_errors(form.subject) }}
                            <small class="form-text text-muted">
                                Le sujet de votre email de réponse
                            </small>
                        </div>

                        <div class="mb-3">
                            {{ form_label(form.reply, 'Contenu de la réponse', {
                                'label_attr': {'class': 'form-label fw-bold'}
                            }) }}
                            {{ form_widget(form.reply, {
                                'attr': {'class': 'form-control', 'rows': 12}
                            }) }}
                            {{ form_errors(form.reply) }}
                            <small class="form-text text-muted">
                                Rédigez votre réponse au client
                            </small>
                        </div>

                        {# Boutons d'action #}
                        <div class="d-flex justify-content-between">
                            <a href="{{ ea_url()
                                .setController('App\\Controller\\Admin\\ContactRequestCrudController')
                                .setAction('index') }}"
                               class="btn btn-secondary">
                                <i class="fa fa-arrow-left"></i>
                                Retour à la liste
                            </a>

                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fa fa-paper-plane"></i>
                                Envoyer la réponse
                            </button>
                        </div>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{# Styles personnalisés pour améliorer le rendu #}
{% block configured_stylesheets %}
    {{ parent() }}
    <style>
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }
        .card-header {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .alert {
            border-radius: 0.375rem;
        }
        dl.row dt {
            font-weight: 600;
            color: #495057;
        }
        dl.row dd {
            color: #212529;
        }
    </style>
{% endblock %}
